<!DOCTYPE html>
<html>
  <head>
    <title>Introduction to Neutron</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Introduction to Openstack Neutron

.presenter[
* Sławek Kapłoński <br/> slawomir.kaplonski@ovh.net
]
---

# Agenda

1. What is Neutron?
  * what is it for in Openstack world?
  * overview
2. Neutron server in details:
  * functions of Neutron server
  * main components of Neutron server
3. Neutron agents:
  * L2 agents (openvswitch, linuxbridge, etc.),
  * L3 agent,
  * metadata, dhcp agents.
4. Standard workflow between Nova and Neutron
5. Network scenarios example(s)

---

class: center

# Neutron in Openstack world

![openstack_architecture](images/openstack-software-diagram.png)  
source: http://www.openstack.org/software

### Neutron is Networking as a Service for Openstack

???
From openstack wiki:
Neutron is an OpenStack project to provide "networking as a
service" between interface devices (e.g., vNICs) managed by other Openstack
services (e.g., nova).

---

class: center

# Neutron main components:

![architecture](images/components_architecture.png)

---

class: center

# Neutron server functions

.left_side_list[
* Process REST API requests
]

---

class: center

# Neutron server functions

.left_side_list[
* Process REST API requests
* Access to database
]

---

class: center

# Neutron server functions

.left_side_list[
* Process REST API requests
* Access to database
* Communicate with agents via RPC (rabbitmq)
]

---

class: center

# Neutron server components

.left_side_list[
* Core plugin - for example ML2 with drivers for openvswitch, linuxbridge and/or SR-IOV
]

---

class: center

# Neutron server components

.left_side_list[
* Core plugin - for example ML2 with drivers for openvswitch, linuxbridge and/or SR-IOV
* Service plugins - like QoS, firewall or l3 router and many others
]

---

class: center

# Neutron server components

.left_side_list[
* Core plugin - for example ML2 with drivers for openvswitch, linuxbridge and/or SR-IOV
* Service plugins - like QoS, firewall or l3 router and many others
* API extenstions - used to add custom REST API functions, list of enabled extenstions can be checked via API call:
]

```bash
neutron ext-list
admin@devstack-1:/opt/stack/neutron$ neutron ext-list
+---------------------------+-----------------------------------------------+
| alias                     | name                                          |
+---------------------------+-----------------------------------------------+
| default-subnetpools       | Default Subnetpools                           |
| qos                       | Quality of Service                            |
+---------------------------+-----------------------------------------------+

neutron ext-show qos
+-------------+-----------------------------------+
| Field       | Value                             |
+-------------+-----------------------------------+
| alias       | qos                               |
| description | The Quality of Service extension. |
| links       |                                   |
| name        | Quality of Service                |
| updated     | 2015-06-08T10:00:00-00:00         |
+-------------+-----------------------------------+
```

---

class: center

# Neutron agents

## L2 agents

.left_side_list[
* Runs on each compute and network node
]

---

class: center

# Neutron agents

## L2 agents

.left_side_list[
* Runs on each compute and network node
* Communicate only with Neutron server via RPC
]

---

class: center

# Neutron agents

## L2 agents

.left_side_list[
* Runs on each compute and network node
* Communicate only with Neutron server via RPC
* Provide L2 connectivity for Neutron ports (like instances)
]

---

class: center

# Neutron agents

## L3 agent

.left_side_list[
* Typically runs on network nodes
]

---

class: center

# Neutron agents

## L3 agent

.left_side_list[
* Typically runs on network nodes
* Provide L3 services like:
  * routing between L2 networks
  * floating IPs
]

---

class: center

# Neutron agents

## L3 agent

.left_side_list[
* Typically runs on network nodes
* Provide L3 services like:
  * routing between L2 networks
  * floating IPs
* uses standard Linux tools:
  * standard Linux IP stack,
  * iptables (NAT),
  * network namespaces to provide isolated routers
]

---

class: center

# Neutron agents

## DHCP and Metadata agent

.left_side_list[
* Both agents typically runs on network nodes
]

---

class: center

# Neutron agents

## DHCP and Metadata agent

.left_side_list[
* Both agents typically runs on network nodes
* DHCP agent provides dhcp service for instances
]

---

class: center

# Neutron agents

## DHCP and Metadata agent

.left_side_list[
* Both agents typically runs on network nodes
* DHCP agent provides dhcp service for instances
* Metadata agent can work together with DHCP or L3 agent
]

---

class: center

# Neutron agents

## DHCP and Metadata agent

.left_side_list[
* Both agents typically runs on network nodes
* DHCP agent provides dhcp service for instances
* Metadata agent can work together with DHCP or L3 agent
* Metadata agent provides proxy between instances and nova-api metadata service
  and provides metadata service for instances on 169.254.169.254:80
]

---

class: center

# Standard workflow between Nova and Neutron

.left_side_list[
1. User creates instance in Nova (nova boot),
2. nova-compute is spawning instance on compute node and call Neutron API to
   create new port (like neutron port-create ...)
]

---

class: center

# Standard workflow between Nova and Neutron

.left_side_list[
1. User creates instance in Nova (nova boot),
2. nova-compute is spawning instance on compute node and call Neutron API to
   create new port (like neutron port-create ...)
3. neutron-server creates port in desired network, allocate IP for this port and try
   to bind port with one of enabled mechanism drivers
]

---

class: center

# Standard workflow between Nova and Neutron

.left_side_list[
1. User creates instance in Nova (nova boot),
2. nova-compute is spawning instance on compute node and call Neutron API to
   create new port (like neutron port-create ...)
3. neutron-server creates port in desired network, allocate IP for this port and try
   to bind port with one of enabled mechanism drivers
4. nova-compute receives from Neutron informations about new port and prepare
   to connect tap device (e.g. create bridge)
5. neutron-server notify L2 agent and DHCP agent about new port
6. nova-compute starts instances and pause it for a while
]

---

class: center

# Standard workflow between Nova and Neutron

.left_side_list[
1. User creates instance in Nova (nova boot),
2. nova-compute is spawning instance on compute node and call Neutron API to
   create new port (like neutron port-create ...)
3. neutron-server creates port in desired network, allocate IP for this port and try
   to bind port with one of enabled mechanism drivers
4. nova-compute receives from Neutron informations about new port and prepare
   to connect tap device (e.g. create bridge)
5. neutron-server notify L2 agent and DHCP agent about new port
6. nova-compute starts instances and pause it for a while
7. Neutron L2 agent connects port to L2 network (vlan tagging, openflow rules, etc.) and notify neutron-server that port is ACTIVE
8. neutron-server notify nova-api that port for instance is ready, nova-compute can then unpause instance
]

---


# Questions?

.presenters[
Sławek Kapłoński <br/> slawomir.kaplonski@ovh.net
]

# Reference

* https://wiki.openstack.org/wiki/Neutron
* http://docs.openstack.org/liberty/networking-guide/deploy.html
* http://slawqo.github.io/introduction_to_neutron/


    </textarea>
    <script src="remark-latest.min.js">
    </script>
    <script>
        var slideshow = remark.create({ratio: '16:9',
                                       countIncrementalSlides: false});
    </script>

    <script src="plotly-latest.min.js"></script>
    <script>



     var port_a = {
              x: [ 'start','no-policy','min-policy-of-8Gb-on-a',],
              y: [ '9.9', '5', '8'],
              name: 'port-a',
              type: 'bar',
              marker: {
                  color: '#00989e'
              }

             };

    var port_b = {
              x: [ 'start','no-policy','min-policy-of-8Gb-on-a',],
              y: [ '0.1','5','2',],
              name: 'port-b',
              type: 'bar',
              marker: {
                  color: '#BF3330'
              }
             };

    var options = {staticPlot: true,
                   showLink: false,
                   displayLogo: false};

    Plotly.newPlot('graph-min-bw-best-eff',
            [ port_a, port_b ],
            { yaxis: { title: 'Bandwidth Gb'},
              title: 'In host minimum bandwidth guarantee',
              margin: { b: 20, t:40 },
              barmode: 'group',
              hovermode:'closest',
              }, options);
    </script>

  </body>
</html>
